<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="oncomsm">
<title>Application to Probability of 'go' • oncomsm</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Application to Probability of 'go'">
<meta property="og:description" content="oncomsm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">oncomsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../articles/oncomsm.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/bhmbasket-integration.html">Integration with bhmbasket</a>
    <a class="dropdown-item" href="../../articles/web_only/application-to-probability-of-success.html">Application to Probability of 'go'</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Boehringer-Ingelheim/oncomsm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Application to Probability of 'go'</h1>
                        <h4 data-toc-skip class="author">Kevin
Kunzmann</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Boehringer-Ingelheim/oncomsm/blob/HEAD/vignettes/web_only/application-to-probability-of-success.Rmd" class="external-link"><code>vignettes/web_only/application-to-probability-of-success.Rmd</code></a></small>
      <div class="d-none name"><code>application-to-probability-of-success.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://boehringer-ingelheim.github.io/oncomsm/">oncomsm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span> <span class="co"># parallel processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doFuture.futureverse.org" class="external-link">doFuture</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://renozao.github.io/doRNG" class="external-link">doRNG</a></span><span class="op">)</span> <span class="co"># parallel safe random number generation</span></span>
<span><span class="co">#&gt; Loading required package: rngtools</span></span>
<span><span class="fu"><a href="https://doFuture.futureverse.org/reference/registerDoFuture.html" class="external-link">registerDoFuture</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span> <span class="co"># instruct future how to run in parallel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42L</span><span class="op">)</span></span></code></pre></div>
<p><strong>tl;dr:</strong> <em>A multi-state model allows sampling
individual-level data. This can be used to impute future trial data from
the prior-predictive distribution at the planning stage. The generated
trial data can then be used to evaluate quantitative ‘go’ decision
criteria to determine whether the sampled data would lead to a ‘go’
decision. The average sampled ‘go’ rate over multiple such data sets is
the a MCMC approximation of the probability of ‘go’. A similar approach
can be taken at any interim time point by sampling from the posterior
predictive distribution conditioning on any observed data. This then
leads to an updated (or conditional) probability of ‘go’.</em></p>
<p>For a general introduction to the multi-state approach used
throughout this package, see the vignette <em>Multi-state Models for
Early Oncology</em>.</p>
<div class="section level2">
<h2 id="decision-criteria-and-probability-of-go">Decision criteria and probability of ‘go’<a class="anchor" aria-label="anchor" href="#decision-criteria-and-probability-of-go"></a>
</h2>
<p>Let <span class="math inline">\(D_t \in \mathbb{D}\)</span> be the
observed (visit) data at time point <span class="math inline">\(t\)</span> after the start of the trial. Let <span class="math inline">\(\tau\)</span> be the stopping time of the trial,
e.g., the time point when all <span class="math inline">\(n\)</span>
individuals have been recruited and have reached their minimal
follow-up. The final decision on ‘go’ can then be modeled as a function
<span class="math inline">\(\phi: \mathbb{D} \to \{0,1\}\)</span>
with</p>
<p><span class="math display">\[\phi(D_\tau)=1 :\Leftrightarrow D_\tau\
\ \text{leads to 'go'}\ . \]</span></p>
<p>Let <span class="math inline">\(\theta\)</span> be a vector of
parameters for a generative model that allows to sample data <span class="math inline">\(D_\tau|\theta\)</span>. Probability of ‘go’ can
the be calculated as expected value of the decision rule under a prior
distribution (density) <span class="math inline">\(f(\theta)\)</span>
over the parameter space: <span class="math display">\[
\operatorname{Pr}\big[\,go\,\big] = \int \phi(D_\tau\,|\,\theta) \cdot
f(\theta) \operatorname{d}\theta \ .
\]</span> In practice, this integral can be approximated by sampling
from the generative model and calculating the average ‘go’ rate.</p>
<p>If data <span class="math inline">\(D_t=d_t\)</span> is observed, the
probability of ‘go’ can be updated using Bayes Theorem <span class="math display">\[
\operatorname{Pr}\big[\,go\,|\, D_t=d_t \,\big] = \int
\phi(D_\tau\,|\,D_t=d_t,\theta) \cdot f(\theta\,|\,D_t=d_t)
\operatorname{d}\theta
\]</span> where <span class="math inline">\(f(\theta\,|\,D_t=d_t)\)</span> is the posterior
density given the data <span class="math inline">\(d_t\)</span> observed
up to time <span class="math inline">\(t\)</span>.</p>
<p>Examples for such decision rules could be</p>
<ol style="list-style-type: decimal">
<li>a quantile of the posterior distribution of the response rate being
above a certain relevance threshold,</li>
<li>a quantile of the posterior distribution of the PFS6 rate being
above a certain relevance threshold,</li>
<li>a quantile of the posterior distribution of PFS being above a
certain threshold,</li>
<li>or a combination of the above.</li>
</ol>
<p>Consider a situation with a trial including two different arms “A”
and “B”. Assume that the following prior for the Weibull SRP multi-state
model with three arms/groups is given.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/srp_model.html">create_srp_model</a></span><span class="op">(</span></span>
<span>  group_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>  logodds_mean <span class="op">=</span> <span class="fu"><a href="../../reference/logodds.html">logodds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  logodds_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2L</span><span class="op">)</span>,</span>
<span>  median_time_to_next_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">24</span>,</span>
<span>    <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">24</span></span>
<span>  <span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  median_time_to_next_event_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  visit_spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  recruitment_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span> <span class="op">/</span> <span class="fl">24</span>, <span class="fl">40</span> <span class="op">/</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One can now sample from the prior and visualize the prior
assumptions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smpl_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">mdl</span>, seed <span class="op">=</span> <span class="fl">6835L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mdl</span>, dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, sample <span class="op">=</span> <span class="va">smpl_prior</span>, n_grid <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<p><img src="application-to-probability-of-success_files/figure-html/sample-from-prios-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="a-composite-orr-and-pfs12-go-criterion">A composite ORR and PFS12 ‘go’ criterion<a class="anchor" aria-label="anchor" href="#a-composite-orr-and-pfs12-go-criterion"></a>
</h2>
<p>Assume that a ‘go’ is defined as a combination of a sufficiently high
response rate and a sufficiently high progression-free-survival rate at
12 months:</p>
<p><span class="math display">\[\phi(D_\tau) := \begin{cases}
  1 \quad \text{if} \quad \operatorname{Pr}\big[\,\text{ORR} \geq 0.3\
\&amp;\ \text{PFS}_{t=12} \geq 0.4 \, | \, D_\tau\,\big] \geq 0.8 \\
  0 \quad \text{else.}
  \end{cases}\]</span></p>
<p>This decision criterion can be implemented as the following
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">go</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">nsim</span> <span class="op">=</span> <span class="fl">200L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3819308</span><span class="op">)</span> <span class="co"># fix the seed for reproducibility</span></span>
<span>  <span class="va">smpl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="co"># low sample size leads to stan warnings on ESS</span></span>
<span>                            <span class="co"># can be ignored, errors average out</span></span>
<span>                            <span class="co"># can also be avoided by increasing nsim</span></span>
<span>    <span class="fu"><a href="../../reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">mdl</span>, data <span class="op">=</span> <span class="va">data</span>, warmup <span class="op">=</span> <span class="fl">200L</span>, nsim <span class="op">=</span> <span class="va">nsim</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">tbl_pfs_orr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../../reference/sample_pfs_rate.html">sample_pfs_rate</a></span><span class="op">(</span><span class="va">mdl</span>, <span class="fl">12</span>, <span class="va">smpl</span><span class="op">)</span>, <span class="co"># PFS 12</span></span>
<span>      <span class="fu"><a href="../../reference/parameter_sample_to_tibble.html">parameter_sample_to_tibble</a></span><span class="op">(</span><span class="va">mdl</span>, <span class="va">smpl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># ORR</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter</span> <span class="op">==</span> <span class="st">"p"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>orr <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">tbl_pfs_orr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># apply decision criterion</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>      go <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pfs</span> <span class="op">&gt;=</span> <span class="fl">0.5</span> <span class="op">&amp;</span> <span class="va">orr</span> <span class="op">&gt;=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.8</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>An example of how to apply the criterion to a sample from the prior
predictive distribution is given below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_prior_predictive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Model.html">sample_predictive</a></span><span class="op">(</span></span>
<span>    <span class="va">mdl</span>,</span>
<span>    n_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">40L</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    sample <span class="op">=</span> <span class="va">smpl_prior</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">34930L</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">go</span><span class="op">(</span><span class="va">tbl_prior_predictive</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   group_id go   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A        FALSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B        TRUE</span></span></code></pre></div>
<p>Next, we can create a table of multiple prior-predictive samples.
Grouping them by iteration and nesting the data frames results in a data
frame of data frames, where <code>tbl_prior_predictive$data[[i]]</code>
corresponds to the data in the <span class="math inline">\(i\)</span>-th
resample.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_prior_predictive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Model.html">sample_predictive</a></span><span class="op">(</span></span>
<span>    <span class="va">mdl</span>,</span>
<span>    n_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">40L</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    sample <span class="op">=</span> <span class="va">smpl_prior</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">100L</span>, <span class="co"># same, here, only for demonstration purposes</span></span>
<span>    seed <span class="op">=</span> <span class="fl">34930L</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_prior_predictive</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 2</span></span></span>
<span><span class="co">#&gt;     iter data                </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 <span style="color: #949494;">&lt;tibble [1,443 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 <span style="color: #949494;">&lt;tibble [1,637 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 <span style="color: #949494;">&lt;tibble [1,152 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 <span style="color: #949494;">&lt;tibble [2,335 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 <span style="color: #949494;">&lt;tibble [1,704 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 <span style="color: #949494;">&lt;tibble [1,743 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 <span style="color: #949494;">&lt;tibble [1,715 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 <span style="color: #949494;">&lt;tibble [938 × 4]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 <span style="color: #949494;">&lt;tibble [1,795 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 <span style="color: #949494;">&lt;tibble [1,964 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 90 more rows</span></span></span></code></pre></div>
<p>Applying the decision criterion to each of them and averaging over
all iterations is an MCMC approximation of the probability of ‘go’.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute results in parallel</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tbl_prior_predictive</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/doRNG/man/grapes-dorng-grapes.html" class="external-link">%dorng%</a></span> <span class="op">{</span></span>
<span>  <span class="fu">go</span><span class="op">(</span><span class="va">tbl_prior_predictive</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># bind results together and aggregate to probability of 'go'</span></span>
<span><span class="va">tbl_pr_go</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">res</span>, .id <span class="op">=</span> <span class="st">"iter"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    `Pr[go]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">go</span><span class="op">)</span>,</span>
<span>    se  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">go</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_pr_go</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   group_id `Pr[go]`     se</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A            0.17 0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B            0.67 0.047<span style="text-decoration: underline;">3</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating-the-probability-of-go-during-a-trial">Updating the probability of ‘go’ during a trial<a class="anchor" aria-label="anchor" href="#updating-the-probability-of-go-during-a-trial"></a>
</h2>
<p>The Bayesian generative model allows calculating the posterior
distribution at any time point given the data observed up to that point.
The future course of the trial can then be sampled from the posterior
predictive distribution.</p>
<p>To illustrate the shift in ‘go’ probability over time, a single trial
realization from a set of fixed response probabilities that conflict
with the prior mean is sampled as hypothetical data. As data accrues,
the evidence will lead to a shift in the posterior probability and thus
the probability of ‘go’.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Model.html">sample_predictive</a></span><span class="op">(</span></span>
<span>    <span class="va">mdl</span>,</span>
<span>    p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.45</span><span class="op">)</span>, <span class="co">## conflicting prior expectation</span></span>
<span>    n_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40L</span>, <span class="fl">40L</span><span class="op">)</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">23849</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,875 × 5</span></span></span>
<span><span class="co">#&gt;    subject_id group_id     t state   iter</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ID00326638 A         4.84 stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ID00326638 A         6.04 stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ID00326638 A         7.24 stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ID00326638 A         8.44 stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ID00326638 A         9.64 stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ID00326638 A        10.8  stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ID00326638 A        12.0  stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ID00326638 A        13.2  stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ID00326638 A        14.4  stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ID00326638 A        15.6  stable     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1,865 more rows</span></span></span></code></pre></div>
<p>Next, interim views of the full data set at a sequence of time points
can be created. This data subsets correspond to the data available at
potential interim analyses.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_data_interims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    t_interim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">24</span>, <span class="fl">36</span><span class="op">)</span> <span class="co"># interim time point (months)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">t_interim</span>, <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tbl_data</span>, <span class="va">t</span> <span class="op">&lt;=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl_data_interims</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   t_interim data                </span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         1 <span style="color: #949494;">&lt;tibble [6 × 5]&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         3 <span style="color: #949494;">&lt;tibble [26 × 5]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         6 <span style="color: #949494;">&lt;tibble [74 × 5]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         9 <span style="color: #949494;">&lt;tibble [135 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        12 <span style="color: #949494;">&lt;tibble [221 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        18 <span style="color: #949494;">&lt;tibble [435 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>        24 <span style="color: #949494;">&lt;tibble [724 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>        36 <span style="color: #949494;">&lt;tibble [1,149 × 5]&gt;</span></span></span></code></pre></div>
<p>For each such interim data set, the remainder of the trial can be
imputed by sampling form the posterior-predictive distribution given the
data observed up to this point. The probability of ‘go’ is then the
average ‘go’ rate in the posterior predictive sample when applying the
decision criterion.</p>
<p>First, the calculation of the probability to ‘go’ is wrapped in a
function that accepts a dataset (<code>tbl</code>) and the number of
resamples (<code>nsim</code>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr_go</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">nsim</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># sample forward from the posterior predictive distribution given data in tbl</span></span>
<span>  <span class="va">tbl_posterior_predictive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>      <span class="va">mdl</span>, <span class="va">tbl</span>, n_per_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">40L</span>, <span class="fl">2</span><span class="op">)</span>, nsim <span class="op">=</span> <span class="va">nsim</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iter</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># determine for each sampled trial whether it ends in a 'go'</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/doRNG/man/grapes-dorng-grapes.html" class="external-link">%dorng%</a></span> <span class="op">{</span></span>
<span>    <span class="fu">go</span><span class="op">(</span><span class="va">tbl_posterior_predictive</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">tbl_pr_go</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">res</span>, .id <span class="op">=</span> <span class="st">"iter"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>      `Pr[go]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">go</span><span class="op">)</span>,</span>
<span>      se  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">go</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tbl_pr_go</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, this function is mapped over all interim time points with the
respective interim data. The number of simulations is the main factor in
determining the runtime of the program besides the number of samples
drawn from the posterior distribution to evaluate the decision
criterion.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_pr_go_over_time</span> <span class="op">&lt;-</span> <span class="va">tbl_data_interims</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    res <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">pr_go</span>, nsim <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is 1.07, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is 1.06, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span></span>
<span><span class="va">tbl_pr_go_over_time</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 5</span></span></span>
<span><span class="co">#&gt;    t_interim data                 group_id `Pr[go]`     se</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 <span style="color: #949494;">&lt;tibble [6 × 5]&gt;</span>     A            0.23 0.042<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         1 <span style="color: #949494;">&lt;tibble [6 × 5]&gt;</span>     B            0.77 0.042<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3 <span style="color: #949494;">&lt;tibble [26 × 5]&gt;</span>    A            0.17 0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         3 <span style="color: #949494;">&lt;tibble [26 × 5]&gt;</span>    B            0.94 0.023<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         6 <span style="color: #949494;">&lt;tibble [74 × 5]&gt;</span>    A            0.7  0.046<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6 <span style="color: #949494;">&lt;tibble [74 × 5]&gt;</span>    B            1    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         9 <span style="color: #949494;">&lt;tibble [135 × 5]&gt;</span>   A            0.83 0.037<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         9 <span style="color: #949494;">&lt;tibble [135 × 5]&gt;</span>   B            0.98 0.014<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        12 <span style="color: #949494;">&lt;tibble [221 × 5]&gt;</span>   A            0.75 0.043<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        12 <span style="color: #949494;">&lt;tibble [221 × 5]&gt;</span>   B            0.91 0.028<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        18 <span style="color: #949494;">&lt;tibble [435 × 5]&gt;</span>   A            0.68 0.046<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>        18 <span style="color: #949494;">&lt;tibble [435 × 5]&gt;</span>   B            0.94 0.023<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>        24 <span style="color: #949494;">&lt;tibble [724 × 5]&gt;</span>   A            0.6  0.049<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>        24 <span style="color: #949494;">&lt;tibble [724 × 5]&gt;</span>   B            0.28 0.045<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>        36 <span style="color: #949494;">&lt;tibble [1,149 × 5]&gt;</span> A            0.59 0.049<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>        36 <span style="color: #949494;">&lt;tibble [1,149 × 5]&gt;</span> B            0.01 0.01</span></span></code></pre></div>
<p>The change of the ‘go’ probability over time is shown below with
error bars corresponding to the standard error of the simulation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tbl_pr_go_over_time</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t_interim</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`Pr[go]`</span> <span class="op">-</span> <span class="va">se</span>, ymax <span class="op">=</span> <span class="va">`Pr[go]`</span> <span class="op">+</span> <span class="va">se</span>,</span>
<span>                    color <span class="op">=</span> <span class="va">group_id</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`Pr[go]`</span>, color <span class="op">=</span> <span class="va">group_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.33</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"t [months]"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span>, by <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="application-to-probability-of-success_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This can be compared to the number of available responses,
progressions, and stable individuals at each time point.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group_id</span>, <span class="va">subject_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    responder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">state</span> <span class="op">!=</span> <span class="st">"progression"</span><span class="op">)</span>,</span>
<span>    progressor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"progression"</span><span class="op">)</span>,</span>
<span>    stable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"stable"</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">responder</span><span class="op">)</span>,</span>
<span>    progression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">progressor</span><span class="op">)</span>,</span>
<span>    stable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">stable</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    t_interim <span class="op">=</span> <span class="va">tbl_data_interims</span><span class="op">$</span><span class="va">t_interim</span>,</span>
<span>    summary <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">tbl_data_interims</span><span class="op">$</span><span class="va">data</span>, <span class="va">f</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">response</span>, <span class="va">progression</span>, <span class="va">stable</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t_interim</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">event</span>, linetype <span class="op">=</span> <span class="va">group_id</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"t [months]"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span>, by <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">""</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="application-to-probability-of-success_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.1 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] doRNG_1.8.2        rngtools_1.5.2     doFuture_0.12.2    foreach_1.5.2     </span></span>
<span><span class="co">#&gt; [5] future_1.29.0      tidyr_1.2.1        dplyr_1.0.10       ggplot2_3.4.0     </span></span>
<span><span class="co">#&gt; [9] oncomsm_0.1.1.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] Rcpp_1.0.9           listenv_0.8.0        prettyunits_1.1.1   </span></span>
<span><span class="co">#&gt;  [4] ps_1.7.2             rprojroot_2.0.3      digest_0.6.30       </span></span>
<span><span class="co">#&gt;  [7] utf8_1.2.2           parallelly_1.32.1    R6_2.5.1            </span></span>
<span><span class="co">#&gt; [10] backports_1.4.1      stats4_4.2.2         evaluate_0.18       </span></span>
<span><span class="co">#&gt; [13] highr_0.9            pillar_1.8.1         rlang_1.0.6         </span></span>
<span><span class="co">#&gt; [16] callr_3.7.3          jquerylib_0.1.4      checkmate_2.1.0     </span></span>
<span><span class="co">#&gt; [19] rmarkdown_2.18       pkgdown_2.0.6        labeling_0.4.2      </span></span>
<span><span class="co">#&gt; [22] textshaping_0.3.6    desc_1.4.2           stringr_1.4.1       </span></span>
<span><span class="co">#&gt; [25] loo_2.5.1            munsell_0.5.0        compiler_4.2.2      </span></span>
<span><span class="co">#&gt; [28] xfun_0.35            rstan_2.21.7         pkgconfig_2.0.3     </span></span>
<span><span class="co">#&gt; [31] systemfonts_1.0.4    pkgbuild_1.3.1       globals_0.16.2      </span></span>
<span><span class="co">#&gt; [34] htmltools_0.5.3      tidyselect_1.2.0     tibble_3.1.8        </span></span>
<span><span class="co">#&gt; [37] gridExtra_2.3        codetools_0.2-18     matrixStats_0.63.0  </span></span>
<span><span class="co">#&gt; [40] fansi_1.0.3          crayon_1.5.2         withr_2.5.0         </span></span>
<span><span class="co">#&gt; [43] grid_4.2.2           jsonlite_1.8.3       gtable_0.3.1        </span></span>
<span><span class="co">#&gt; [46] lifecycle_1.0.3      magrittr_2.0.3       StanHeaders_2.21.0-7</span></span>
<span><span class="co">#&gt; [49] scales_1.2.1         RcppParallel_5.1.5   cli_3.4.1           </span></span>
<span><span class="co">#&gt; [52] stringi_1.7.8        cachem_1.0.6         farver_2.1.1        </span></span>
<span><span class="co">#&gt; [55] fs_1.5.2             bslib_0.4.1          ellipsis_0.3.2      </span></span>
<span><span class="co">#&gt; [58] ragg_1.2.4           generics_0.1.3       vctrs_0.5.1         </span></span>
<span><span class="co">#&gt; [61] iterators_1.0.14     tools_4.2.2          glue_1.6.2          </span></span>
<span><span class="co">#&gt; [64] purrr_0.3.5          processx_3.8.0       parallel_4.2.2      </span></span>
<span><span class="co">#&gt; [67] fastmap_1.1.0        yaml_2.3.6           inline_0.3.19       </span></span>
<span><span class="co">#&gt; [70] colorspace_2.0-3     memoise_2.0.1        knitr_1.41          </span></span>
<span><span class="co">#&gt; [73] patchwork_1.1.2      sass_0.4.4</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Kunzmann, Boehringer Ingelheim Ltd..</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
